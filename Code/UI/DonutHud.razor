@using Sandbox.UI
@using Sandbox.Services
@using System
@using System.Threading.Tasks
@inherits PanelComponent
@namespace Donut.UI

<root>
	<div class="left">
		<div class="current-song">
            <div class="name">Now playing:</div>
			<div class="artist">@Donut.player.Title</div>
		</div>
	</div>
	<div class="right">
		<div class="player-list">
			@foreach (var player in NetworkManager.Players)
			{
				<div class="player-entry">
					<img src=@($"avatar:{player?.SteamId}") class="avatar" />
                    <label class="name">@player?.GameObject.Name @($"\u2500") @player?.Time</label>
					@if ((NetworkManager.Instance?.Host?.SteamId ?? 0) == (ulong)player?.SteamId)
					{
						<i>verified</i>
					}
				</div>
			}
		</div>
        <div class="button" onclick=@( () => Donate() )>
            Donate? (Test)
        </div>
	</div>
</root>

@code
{
    [Property] GamePass Pass { get; set; }

    private void Donate()
    {
        if (!Game.ActiveScene.Components.TryGet<ScreenPanel>(out var panel) && panel?.GetPanel()?.ElementName != "monetization")
        {
            // if (Monetization.Has(Pass)) return; doesn't work for now

            foreach (PanelComponent panelcomp in Game.ActiveScene.Components.GetAll<PanelComponent>().ToArray()) panelcomp.Panel.Style.PointerEvents = PointerEvents.None;

            Monetization.Purchase(Pass);
        }
        else
        {
            return;
        }
    }

    protected override int BuildHash() => HashCode.Combine(RealTime.GlobalNow);
}
